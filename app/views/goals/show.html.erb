<section role='main'>

    <p id="notice"><%= notice %></p>

    <section class='goal'>

        <div class='goal-wrap'>
            <% @goal.color ||= 'fbcc91' %>
            <% @goal.badge ||= 'star.svg?color=4d2d74' %>

            <div id='<%= @goal.id %>' style='background: #<%= @goal.color %>' class='badge draggable'>
                <img class='logo' src='/svg/<%= @goal.badge %>' />
            </div>

            <section>
                <header>
                    <h3><%= @goal.name %></h2>
                    <%= link_to 'Edit', edit_goal_path(@goal) %>
                     路 
                    <%= link_to 'Destroy', @goal, method: :delete, data: { confirm: 'Are you sure?' } %>
                </header>

                <div class='actions'>
                    <span><%= @goal.points %> points</span>
                    <% if @goal.completed %>
                        <span> 路 completed</span>
                    <% else %>
                        <span> 路 in progress</span>
                    <% end %>
                     <!-- vs in bucket -->

                    <span> 路 created by <%= link_to @goal.user.name, @goal.user %> <%= time_ago_in_words(@goal.created_at) %> ago</span>
                </div>
            </section>

            <ul>
                <li>
                    <h3>10</h3>
                    <p>completed</p>
                </li>
                <li>
                    <h3>3</h3>
                    <p>this month</p>
                </li>
            </ul>

        </div>

        <!-- <p>Total points: 100 (30 this month)</p>
                <p>Completed 10 times (3 times this month)</p> -->


        <!-- Ancestry looks ugly. Fix it -->
        <!-- Do add sub goal (make it a lot easier and intuitive) -->
        <!-- (Fix subgoal first) Work out logic for adding and removing things (for everything) -->
        

        <!-- Achievements + badge view -->

        <!-- Badges + color picker -->

        <!-- Info -->
        
        <!-- Sharing and friends -->

        <ul style='margin-left: 25px'>
            <%= nested_goals @goal.descendants.arrange %>
        </ul>

        <p>How to display subgoals? (add subgoal should not be a link? or maybe link to edit page with ?subgoal=true)</p>
        <%= link_to 'Add sub goal', new_goal_path(:parent_id => @goal.id) %>

        <% if @goal.description.length > 0 %>
            <h4>Description</h4>
            <p><%= @goal.description %></p>
        <% else %>
            <p style='color: #CCC'>No description</p>
        <% end %>

        <% if @goal.has_deadline %>
            <h4>Deadline</h4>
            <p><%= @goal.deadline.strftime('%e %b %y') %></p>
        <% else %>
            <p style='color: #CCC'>No deadline set</p>
        <% end %>

        <!-- <p>Completed at:</p> -->

        <h3>Shared with</h3>
        <p style='color:#CCC'>No one</p>
        <a>Invite your friends to join you</a>
        <!-- <p>Stuffs</p>

        <p>Maybe show other people's progress</p> -->

    </section>

    <section class='events'>
        <h3>Timeline</h3>
        <p> <!-- change to ol -->
            <a class='selected'>All</a>
            <% @goal.months.each do |m| %>
                <span> | </span>
                <a><%= m.created_at.strftime('%b') %></a>
            <% end %>
        </p>

        <!-- Add DECEMBER between transistion of months -->
        <ul>
            <li class='event special'>
                <div class='day'>
                    <%= @goal.created_at.day %>
                </div>
                <div>
                    <h3>CREATED</h3>
                    <p><%= @goal.created_at.strftime('%l:%M %p - %B %e, %Y') %></p>
                </div>
            </li>

            <%= render :partial => 'events/event', :collection => @goal.events, :as => :event %>

            <% if @goal.completed %>
                <li class='event special'>
                    <div class='day'>
                        <%= @goal.created_at.day %>
                    </div>
                    <div>
                        <h3>ACHIEVEMENT UNLOCKED</h3>
                        <p><%= @goal.completed_at.strftime('%l:%M %p - %B %e, %Y') %></p>
                    </div>
                    
                    <div id='<%= @goal.id %>' style='background: #<%= @goal.color %>' class='badge draggable'>
                        <img class='logo' src='/svg/<%= @goal.badge %>' />
                    </div>


                </li>
            <% end %>
        </ul>

    </section>

    <%= link_to 'Back', @goal.user %>

</section>